:github-address: https://github.com/hazelcast-guides/hazelcast-quarkus-guide
:templates-url: https://raw.githubusercontent.com/hazelcast-guides/adoc-templates/master
:hazelcast: Hazelcast IMDG
:framework: Quarkus

= Getting Started with Hazelcast Client and Quarkus

This guide will get you started to use Hazelcast Client in a Quarkus application.

== What Youâ€™ll Learn

In this guide, you'll see how to quickly set up a native-image-ready Quarkus application using Hazelcast Client.

== Prerequisites

Make sure that both Docker and Docker Compose are installed (and that Docker daemon has enough memory to work with).

[source]
----
$ docker -v
Docker version 19.03.5, build 633a0ea
$ docker-compose -v
docker-compose version 1.24.1, build 4667896b
----

If Docker isn't installed, check the official Getting Started guide: [Docker Getting Started](https://www.docker.com/get-started)

== Hazelcast-Quarkus Code Sample

This guide showcases how to setup a basic Quarkus application to work with Hazelcast Client-Server Topology.

The `put` operation places a key-value pair to Hazelcast and `get` operation returns the value along with the ontainer Name.

The Container Name is present to make it clear from which instance the value is returned from.

== Building Quarkus Application

To build a standalone jar, you can use a standard Maven command:

[source]
----
mvn package
----

Now, we're ready to build the Docker image:

[source]
----
docker build . -f Dockerfile -t hazelcast-guides/hazelcast-quarkus-native
----

=== Building Quarkus Native Executable

To build a native executable, you can use the dedicated _native_ Maven profile:

[source]
----
mvn clean package -Pnative -Dnative-image.docker-build=true
----

The `-Dnative-image.docker-build=true` build parameter runs the native compilation inside a special GraalVM-enabled Docker container provided by Quarkus.
However, if you wish, you can use your local GraalVM setup.

Now, we're ready to build the Docker image (based on a dedicated native-friendly Dockerfile):

[source]
----
docker build . -f Dockerfile.native -t hazelcast-guides/hazelcast-quarkus-native
----

However, keep in mind that native mode doesn't support all features out-of-the-box (https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md).

=== Application

We're ready to launch the application consisting of a Hazelcast cluster and two Quarkus applications:

[source]
----
docker-compose up -d
----

We can verify that two members joined the Hazelcast cluster:

[source]
----
$ docker logs member1 -f
...
 Members {size:2, ver:2} [
	Member [172.30.0.2]:5701 - b123eadd-e3e6-4605-867d-1f1f40a2eaf2 this
	Member [172.30.0.3]:5701 - c31026b6-e01d-45f7-b3b2-3d0338d67ef2
]
...
----

We can verify that Quarkus applications started properly (notice the startup time of 14ms!):

[source]
----
$ docker logs quarkus-service1 -f
2019-12-13 23:40:27,298 INFO  [io.quarkus] (main) hazelcast-quarkus-guide 1.0-SNAPSHOT (running on Quarkus 1.0.0.Final) started in 0.014s. Listening on: http://0.0.0.0:8080
2019-12-13 23:40:27,299 INFO  [io.quarkus] (main) Profile prod activated.
2019-12-13 23:40:27,299 INFO  [io.quarkus] (main) Installed features: [cdi, resteasy, resteasy-jackson, resteasy-jsonb]...
----

Send a put operation to the first application running on port 8081:

[source]
----
$ curl -X POST "localhost:8081/hazelcast/put?key=key_1&value=value_1";echo;
{"containerName":"quarkus-service2","value":"value_1"}
----

Get the value from application running on 8080 and verify that it's the same value as put operation:

[source]
----
$ curl "localhost:8080/hazelcast/get?key=key_1";echo;
{"containerName":"quarkus-service1","value":"value_1"}
----

Clean Up

[source]
----
$ docker-compose down
----

== Summary

In this guide, we bootstrapped a native-image-ready Quarkus application which uses Hazelcast Client.

We started two application instances, and they formed a Hazelcast cluster. Since the data was shared among all Hazelcast cluster instances, we could access it from both application instances.

== See Also

- https://github.com/hazelcast-guides/hazelcast-quarkus-kubernetes[Quarkus and Hazelcast Client on Kubernetes]